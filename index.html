<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechHub - 科技分享社区</title>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #3b82f6;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --bg-light: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.7);
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --like-color: #ef4444;
            --bookmark-color: #f59e0b;
        }

        /* 深色主题变量 */
        .dark-theme {
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --bg-light: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --glass-bg: rgba(30, 41, 59, 0.15);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-light: rgba(0, 0, 0, 0.2);
            --shadow-medium: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background-color: var(--bg-light);
            background-image: 
                radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(139, 92, 246, 0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.1) 0px, transparent 50%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .dark-theme body {
            background-image: 
                radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.05) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(139, 92, 246, 0.05) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(59, 130, 246, 0.05) 0px, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* 顶部导航栏 */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background-color: var(--glass-bg);
            border-bottom: 1px solid var(--glass-border);
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo i {
            font-size: 1.6rem;
        }

        .desktop-nav {
            display: flex;
            gap: 20px;
        }

        .nav-item {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            padding: 6px 14px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--glass-bg);
            color: var(--primary-color);
        }

        .user-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
            width: 220px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 36px 8px 12px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .search-box i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* 主内容区域 */
        .main-content {
            display: flex;
            gap: 25px;
            min-height: calc(100vh - 140px);
        }

        /* 内容区域通用样式 */
        .content-section {
            flex: 1;
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 卡片样式 */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 18px;
            border: 1px solid var(--glass-border);
            padding: 20px;
            box-shadow: 0 6px 24px var(--shadow-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 18px;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 32px var(--shadow-medium);
        }

        /* 首页样式 */
        .hero-banner {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            border-radius: 18px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .hero-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .hero-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 600px;
            line-height: 1.5;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 18px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-light);
        }

        .feature-icon {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: white;
            font-size: 1.3rem;
        }

        /* 发现页样式 */
        .discover-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
        }

        .discover-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .discover-image {
            height: 150px;
            background: linear-gradient(135deg, #a78bfa, #60a5fa);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .discover-content {
            padding: 18px;
        }

        .discover-content h3 {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .discover-content p {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .discover-tags {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .tag {
            background-color: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* 社区页样式 */
        .community-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .post-search {
            width: 280px;
        }

        .post-search input {
            width: 100%;
            padding: 10px 18px;
            border-radius: 18px;
            border: 1px solid var(--glass-border);
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .new-post-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.3s ease;
        }

        .new-post-btn:hover {
            transform: scale(1.05);
        }

        .posts-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .post-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            position: relative;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .post-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .post-meta h4 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .post-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .post-tags {
            display: flex;
            gap: 6px;
        }

        .post-content {
            margin: 16px 0;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .post-actions {
            display: flex;
            gap: 20px;
            margin-top: 16px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s ease;
            position: relative;
            user-select: none;
        }

        .post-action:hover {
            color: var(--primary-color);
        }

        .post-action.liked {
            color: var(--like-color);
        }

        .post-action.bookmarked {
            color: var(--bookmark-color);
        }

        .post-action.share-active {
            color: var(--accent-color);
        }

        .like-animation {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: var(--like-color);
            opacity: 0;
            pointer-events: none;
            animation: floatUp 1s ease-out;
        }

        @keyframes floatUp {
            0% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-30px); opacity: 0; }
        }

        .bookmark-animation {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: var(--bookmark-color);
            opacity: 0;
            pointer-events: none;
            animation: floatUp 1s ease-out;
        }

        /* 评论区域 */
        .comments-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
            display: none;
        }

        .comments-section.expanded {
            display: block;
        }

        .comment-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .comment-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .comment-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .comment {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .comment-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .comment-content {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* 我的页面样式 */
        .profile-header {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 700;
            border: 4px solid var(--card-bg);
        }

        .profile-info h2 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        .profile-info p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .profile-stats {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .my-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .my-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .my-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-light);
        }

        .my-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: white;
            font-size: 1.6rem;
        }

        .my-card h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .my-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* 移动端导航栏 */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid var(--glass-border);
            padding: 10px 0;
            z-index: 100;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 0.8rem;
            transition: color 0.3s ease;
        }

        .mobile-nav-item.active {
            color: var(--primary-color);
        }

        .mobile-nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        /* 响应式设计 */
        @media (max-width: 992px) {
            .desktop-nav, .user-actions {
                display: none;
            }
            
            .mobile-nav {
                display: block;
            }
            
            .main-content {
                margin-bottom: 70px;
                min-height: calc(100vh - 100px);
            }
            
            .search-box {
                width: 100%;
            }
            
            .container {
                padding: 0 15px;
            }
            
            .hero-banner {
                padding: 24px;
            }
            
            .hero-title {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 768px) {
            .hero-banner {
                padding: 20px;
            }
            
            .hero-title {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }
            
            .hero-subtitle {
                font-size: 0.95rem;
            }
            
            .community-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .post-search {
                width: 100%;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
            
            .section-title {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .featured-grid,
            .discover-grid,
            .my-grid {
                grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
                gap: 15px;
            }
            
            .post-actions {
                flex-wrap: wrap;
                gap: 15px;
            }
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(30px) saturate(180%);
            border-radius: 18px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 20px 24px 15px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.4rem;
        }

        .modal-body {
            padding: 20px 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .file-upload {
            border: 2px dashed var(--glass-border);
            border-radius: 10px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background-color: rgba(99, 102, 241, 0.05);
        }

        .modal-footer {
            padding: 15px 24px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* 主题设置模态框 */
        .theme-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .theme-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(99, 102, 241, 0.05);
        }
        
        .theme-option.active {
            border-color: var(--primary-color);
            background-color: rgba(99, 102, 241, 0.1);
        }
        
        .theme-preview {
            width: 60px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
        }
        
        .theme-light .theme-preview {
            background: linear-gradient(135deg, #f8fafc 50%, #e2e8f0 50%);
        }
        
        .theme-dark .theme-preview {
            background: linear-gradient(135deg, #0f172a 50%, #1e293b 50%);
        }
        
        .theme-auto .theme-preview {
            background: linear-gradient(135deg, #f8fafc 50%, #0f172a 50%);
        }
        
        .theme-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .theme-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }
        
        .dark-theme ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark-theme ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
        }
        
        .dark-theme ::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.7);
        }
        
        /* 提示框样式 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast i {
            font-size: 1.2rem;
        }
        
        .toast.success i {
            color: #10b981;
        }
        
        .toast.info i {
            color: var(--primary-color);
        }
        
        .toast.warning i {
            color: #f59e0b;
        }
        
        /* 加载动画 */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 用户名输入样式 */
        .username-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 0.95rem;
            outline: none;
            text-align: center;
            width: 120px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 2px;
        }
        
        .username-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* 统计信息样式 */
        .community-stats {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 15px 20px;
            border: 1px solid var(--glass-border);
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* 发帖模态框简化版 */
        .simple-modal .form-group {
            margin-bottom: 20px;
        }
        
        .simple-modal .form-control {
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .simple-modal textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        /* 标签选择器 */
        .tag-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tag-option {
            padding: 6px 12px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 16px;
            font-size: 0.85rem;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .tag-option:hover, .tag-option.selected {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="container nav-container">
            <a href="#" class="logo">
                <i class="fas fa-microchip"></i>
                <span>TechHub</span>
            </a>
            
            <nav class="desktop-nav">
                <a href="#" class="nav-item active" data-section="home">首页</a>
                <a href="#" class="nav-item" data-section="discover">发现</a>
                <a href="#" class="nav-item" data-section="community">社区</a>
                <a href="#" class="nav-item" data-section="profile">我的</a>
            </nav>
            
            <div class="user-actions">
                <div class="search-box">
                    <input type="text" id="globalSearch" placeholder="搜索内容、用户或资源...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="avatar" id="userAvatar" title="点击设置用户名">
                    <input type="text" id="usernameInput" class="username-input" placeholder="设置用户名" maxlength="20">
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <main class="container main-content">
        <!-- 首页 -->
        <section id="home" class="content-section active">
            <div class="hero-banner">
                <div class="hero-content">
                    <h1 class="hero-title">欢迎来到 TechHub</h1>
                    <p class="hero-subtitle">一个专注于科技分享与交流的社区。发现最新技术动态，分享你的创意项目，与全球开发者交流互动。</p>
                </div>
            </div>
            
            <h2 class="section-title"><i class="fas fa-fire"></i> 热门内容</h2>
            
            <div class="featured-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3>AI 工具推荐</h3>
                    <p>精选最新人工智能工具，提升你的工作效率和创造力。</p>
                    <div class="discover-tags">
                        <span class="tag">AI</span>
                        <span class="tag">工具</span>
                        <span class="tag">2026</span>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <h3>前端框架对比</h3>
                    <p>React、Vue、Angular 最新特性对比，帮你选择最适合的技术栈。</p>
                    <div class="discover-tags">
                        <span class="tag">前端</span>
                        <span class="tag">框架</span>
                        <span class="tag">对比</span>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>移动开发趋势</h3>
                    <p>2026年移动开发最新趋势，Flutter、React Native、SwiftUI 深度解析。</p>
                    <div class="discover-tags">
                        <span class="tag">移动开发</span>
                        <span class="tag">趋势</span>
                        <span class="tag">2026</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 发现页 -->
        <section id="discover" class="content-section">
            <h2 class="section-title"><i class="fas fa-compass"></i> 发现有趣内容</h2>
            
            <div class="discover-grid">
                <div class="discover-card">
                    <div class="discover-image">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div class="discover-content">
                        <h3>游戏开发者的新工具</h3>
                        <p>探索最新的游戏开发工具和引擎，提升你的游戏开发效率。</p>
                        <div class="discover-tags">
                            <span class="tag">游戏开发</span>
                            <span class="tag">工具</span>
                            <span class="tag">Unity</span>
                        </div>
                    </div>
                </div>
                
                <div class="discover-card">
                    <div class="discover-image">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="discover-content">
                        <h3>数据可视化实践</h3>
                        <p>使用 D3.js 和 Three.js 创建惊艳的数据可视化效果。</p>
                        <div class="discover-tags">
                            <span class="tag">数据可视化</span>
                            <span class="tag">D3.js</span>
                            <span class="tag">Three.js</span>
                        </div>
                    </div>
                </div>
                
                <div class="discover-card">
                    <div class="discover-image">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="discover-content">
                        <h3>网络安全指南</h3>
                        <p>了解最新的网络安全威胁和防护策略，保护你的应用和数据。</p>
                        <div class="discover-tags">
                            <span class="tag">网络安全</span>
                            <span class="tag">防护</span>
                            <span class="tag">加密</span>
                        </div>
                    </div>
                </div>
                
                <div class="discover-card">
                    <div class="discover-image">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="discover-content">
                        <h3>云原生技术栈</h3>
                        <p>Docker、Kubernetes 和云原生应用开发的最佳实践。</p>
                        <div class="discover-tags">
                            <span class="tag">云原生</span>
                            <span class="tag">Docker</span>
                            <span class="tag">Kubernetes</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 社区页 -->
        <section id="community" class="content-section">
            <div class="community-header">
                <h2 class="section-title"><i class="fas fa-users"></i> 社区讨论</h2>
                <div class="post-search">
                    <input type="text" id="postSearch" placeholder="搜索帖子...">
                </div>
                <button class="new-post-btn" id="newPostBtn">
                    <i class="fas fa-plus"></i> 创建新帖子
                </button>
            </div>
            
            <!-- 社区统计信息 -->
            <div class="community-stats" id="communityStats">
                <div class="stat-card">
                    <span class="stat-number" id="totalPostsCount">0</span>
                    <span class="stat-label">总帖子数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalLikesCount">0</span>
                    <span class="stat-label">总点赞数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalCommentsCount">0</span>
                    <span class="stat-label">总评论数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="activeUsersCount">0</span>
                    <span class="stat-label">活跃用户</span>
                </div>
            </div>
            
            <div class="posts-container" id="postsContainer">
                <!-- 帖子将通过JS动态添加 -->
                <div class="loading" id="postsLoading">
                    <i class="fas fa-spinner"></i>
                    <p>加载帖子中...</p>
                </div>
            </div>
        </section>

        <!-- 我的页面 -->
        <section id="profile" class="content-section">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">T</div>
                <div class="profile-info">
                    <h2 id="profileUsername">TechHub 用户</h2>
                    <p>前端开发者 | 开源爱好者 | 科技博主</p>
                    <p>加入时间：2026年1月 · 最后活跃：今天</p>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="myPostsCount">0</div>
                            <div class="stat-label">帖子</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="myLikesCount">0</div>
                            <div class="stat-label">获赞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="myCommentsCount">0</div>
                            <div class="stat-label">评论</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2 class="section-title"><i class="fas fa-user-cog"></i> 我的功能</h2>
            
            <div class="my-grid">
                <div class="my-card" data-action="theme">
                    <div class="my-card-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h3>主题设置</h3>
                    <p>切换浅色/深色主题和界面风格</p>
                </div>
                
                <div class="my-card" data-action="about">
                    <div class="my-card-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <h3>关于我们</h3>
                    <p>了解TechHub社区的发展历程</p>
                </div>
            </div>
        </section>
    </main>

    <!-- 移动端底部导航 -->
    <nav class="mobile-nav">
        <div class="mobile-nav-items">
            <a href="#" class="mobile-nav-item active" data-section="home">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </a>
            <a href="#" class="mobile-nav-item" data-section="discover">
                <i class="fas fa-compass"></i>
                <span>发现</span>
            </a>
            <a href="#" class="mobile-nav-item" data-section="community">
                <i class="fas fa-users"></i>
                <span>社区</span>
            </a>
            <a href="#" class="mobile-nav-item" data-section="profile">
                <i class="fas fa-user"></i>
                <span>我的</span>
            </a>
        </div>
    </nav>

    <!-- 简化版创建新帖子模态框 -->
    <div class="modal" id="postModal">
        <div class="modal-content simple-modal">
            <div class="modal-header">
                <h2>创建新帖子</h2>
                <i class="fas fa-times close-modal" id="closeModal"></i>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="postTitle">标题</label>
                    <input type="text" id="postTitle" class="form-control" placeholder="请输入帖子标题" maxlength="100">
                    <div class="char-count" id="titleCount">0/100</div>
                </div>
                
                <div class="form-group">
                    <label for="postCategory">分类</label>
                    <select id="postCategory" class="form-control">
                        <option value="">请选择分类</option>
                        <option value="技术问答">技术问答</option>
                        <option value="资源分享">资源分享</option>
                        <option value="技术讨论">技术讨论</option>
                        <option value="教程指南">教程指南</option>
                        <option value="科技资讯">科技资讯</option>
                        <option value="项目展示">项目展示</option>
                        <option value="求职招聘">求职招聘</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="postContent">内容</label>
                    <textarea id="postContent" class="form-control" rows="8" placeholder="请输入帖子内容..." maxlength="2000"></textarea>
                    <div class="char-count" id="contentCount">0/2000</div>
                </div>
                
                <div class="form-group">
                    <label>标签</label>
                    <div class="tag-options" id="tagOptions">
                        <span class="tag-option" data-tag="前端">前端</span>
                        <span class="tag-option" data-tag="后端">后端</span>
                        <span class="tag-option" data-tag="AI">AI</span>
                        <span class="tag-option" data-tag="移动开发">移动开发</span>
                        <span class="tag-option" data-tag="数据库">数据库</span>
                        <span class="tag-option" data-tag="DevOps">DevOps</span>
                        <span class="tag-option" data-tag="云计算">云计算</span>
                        <span class="tag-option" data-tag="网络安全">网络安全</span>
                    </div>
                    <input type="text" id="postTagsInput" class="form-control" placeholder="或输入自定义标签（用逗号分隔）">
                </div>
                
                <div class="form-group">
                    <div id="selectedTags"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPost">取消</button>
                <button class="btn btn-primary" id="submitPost">
                    <i class="fas fa-paper-plane"></i> 发布帖子
                </button>
            </div>
        </div>
    </div>

    <!-- 主题设置模态框 -->
    <div class="modal" id="themeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>主题设置</h2>
                <i class="fas fa-times close-modal" id="closeThemeModal"></i>
            </div>
            <div class="modal-body">
                <div class="theme-options">
                    <div class="theme-option theme-light active" data-theme="light">
                        <div class="theme-preview"></div>
                        <div class="theme-info">
                            <h4>浅色主题</h4>
                            <p>明亮清晰的界面，适合白天使用</p>
                        </div>
                        <i class="fas fa-check-circle" style="margin-left: auto; color: var(--primary-color);"></i>
                    </div>
                    
                    <div class="theme-option theme-dark" data-theme="dark">
                        <div class="theme-preview"></div>
                        <div class="theme-info">
                            <h4>深色主题</h4>
                            <p>暗色界面，减少眼睛疲劳，适合夜间使用</p>
                        </div>
                        <i class="fas fa-check-circle" style="margin-left: auto; color: var(--primary-color); display: none;"></i>
                    </div>
                    
                    <div class="theme-option theme-auto" data-theme="auto">
                        <div class="theme-preview"></div>
                        <div class="theme-info">
                            <h4>跟随系统</h4>
                            <p>自动跟随系统主题设置切换</p>
                        </div>
                        <i class="fas fa-check-circle" style="margin-left: auto; color: var(--primary-color); display: none;"></i>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTheme">取消</button>
                <button class="btn btn-primary" id="saveTheme">保存设置</button>
            </div>
        </div>
    </div>

    <!-- 帖子发布成功模态框 -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-body">
                <div class="post-success" style="text-align: center; padding: 40px 20px;">
                    <i class="fas fa-check-circle" style="font-size: 4rem; color: #10b981; margin-bottom: 20px;"></i>
                    <h3 style="font-size: 1.5rem; margin-bottom: 10px;">帖子发布成功！</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 25px;">您的帖子已成功发布到社区，现在其他用户可以看到并回复您的帖子了。</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-secondary" id="closeSuccessModal">关闭</button>
                        <button class="btn btn-primary" id="newPostBtn2">再发一篇</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示框 -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span class="toast-message">操作成功</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        // ============================
        // 初始化 Supabase
        // ============================
        const supabaseUrl = "https://jsrxbpysgaywdhnntqnl.supabase.co";
        const supabaseAnonKey = "sb_publishable_sjh3mv3dOdIy4NHWjrvdDw_wpd7iAuw";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        
        // ============================
        // 全局变量
        // ============================
        let currentUserName = "TechHub用户";
        let currentUserId = null;
        let currentPostId = null;
        let selectedTags = [];
        let isSubmitting = false;
        
        // ============================
        // DOM 元素
        // ============================
        const usernameInput = document.getElementById('usernameInput');
        const userAvatar = document.getElementById('userAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileUsername = document.getElementById('profileUsername');
        const postsContainer = document.getElementById('postsContainer');
        const postsLoading = document.getElementById('postsLoading');
        const postSearch = document.getElementById('postSearch');
        const globalSearch = document.getElementById('globalSearch');
        
        // 统计元素
        const totalPostsCount = document.getElementById('totalPostsCount');
        const totalLikesCount = document.getElementById('totalLikesCount');
        const totalCommentsCount = document.getElementById('totalCommentsCount');
        const activeUsersCount = document.getElementById('activeUsersCount');
        const myPostsCount = document.getElementById('myPostsCount');
        const myLikesCount = document.getElementById('myLikesCount');
        const myCommentsCount = document.getElementById('myCommentsCount');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            initUsername();
            loadPosts();
            updateCommunityStats();
            initThemeSettings();
        });
        
        // ============================
        // 用户名功能
        // ============================
        function initUsername() {
            // 从localStorage获取保存的用户名
            const savedUsername = localStorage.getItem('techhub_username');
            if (savedUsername) {
                currentUserName = savedUsername;
                usernameInput.value = savedUsername;
                profileUsername.textContent = savedUsername;
                profileAvatar.textContent = savedUsername.charAt(0).toUpperCase();
            } else {
                // 生成随机用户名
                currentUserName = "用户" + Math.floor(Math.random() * 10000);
                usernameInput.value = currentUserName;
                localStorage.setItem('techhub_username', currentUserName);
                profileUsername.textContent = currentUserName;
                profileAvatar.textContent = currentUserName.charAt(0).toUpperCase();
            }
            
            // 用户名输入事件
            usernameInput.addEventListener('change', (e) => {
                const newUsername = e.target.value.trim() || "TechHub用户";
                currentUserName = newUsername;
                localStorage.setItem('techhub_username', newUsername);
                profileUsername.textContent = newUsername;
                profileAvatar.textContent = newUsername.charAt(0).toUpperCase();
                showToast(`用户名已更新为: ${newUsername}`, 'success');
            });
            
            // 点击头像显示用户名输入
            userAvatar.addEventListener('click', () => {
                usernameInput.focus();
                usernameInput.select();
            });
        }
        
        // ============================
        // 帖子功能
        // ============================
        async function loadPosts() {
            try {
                postsLoading.style.display = 'block';
                
                // 从Supabase获取帖子数据
                const { data: posts, error } = await supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                postsContainer.innerHTML = '';
                
                if (!posts || posts.length === 0) {
                    postsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-comment-slash"></i>
                            <h3>暂无帖子</h3>
                            <p>还没有人发布帖子，快来发布第一个吧！</p>
                        </div>
                    `;
                    return;
                }
                
                // 为每个帖子获取点赞和评论数量
                for (const post of posts) {
                    const postElement = await createPostElement(post);
                    postsContainer.appendChild(postElement);
                }
                
                // 更新我的帖子统计
                updateMyStats();
            } catch (error) {
                console.error('加载帖子失败:', error);
                postsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>加载失败</h3>
                        <p>请刷新页面重试</p>
                    </div>
                `;
            } finally {
                postsLoading.style.display = 'none';
            }
        }
        
        async function createPostElement(post) {
            const postElement = document.createElement('div');
            postElement.className = 'post-card';
            postElement.dataset.postId = post.id;
            
            // 获取帖子的点赞和评论数量
            const { count: likesCount } = await supabase
                .from('likes')
                .select('*', { count: 'exact', head: true })
                .eq('post_id', post.id);
            
            const { count: commentsCount } = await supabase
                .from('comments')
                .select('*', { count: 'exact', head: true })
                .eq('post_id', post.id);
            
            // 检查当前用户是否已经点赞
            const { data: userLike } = await supabase
                .from('likes')
                .select('id')
                .eq('post_id', post.id)
                .eq('user_id', currentUserName)
                .maybeSingle();
            
            const isLiked = !!userLike;
            
            // 格式化时间
            const postTime = formatPostTime(post.created_at);
            
            // 处理标签
            const tags = post.tags ? post.tags.split(',').map(tag => tag.trim()) : [];
            
            postElement.innerHTML = `
                <div class="post-header">
                    <div class="post-author">
                        <div class="author-avatar">${post.author ? post.author.charAt(0).toUpperCase() : 'T'}</div>
                        <div class="post-meta">
                            <h4>${post.author || '匿名用户'}</h4>
                            <div class="post-time">${postTime} · ${post.category || '技术讨论'}</div>
                        </div>
                    </div>
                    <div class="post-tags">
                        ${tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </div>
                <h3 style="margin-bottom: 12px; font-size: 1.3rem;">${post.title}</h3>
                <div class="post-content">
                    ${post.content.replace(/\n/g, '<br>')}
                </div>
                <div class="post-actions">
                    <div class="post-action like-action ${isLiked ? 'liked' : ''}" data-count="${likesCount || 0}">
                        <i class="${isLiked ? 'fas' : 'far'} fa-thumbs-up"></i>
                        <span class="action-count">${likesCount || 0}</span>
                    </div>
                    <div class="post-action comment-action" data-count="${commentsCount || 0}">
                        <i class="far fa-comment"></i>
                        <span class="action-count">${commentsCount || 0}</span>
                    </div>
                    <div class="post-action share-action">
                        <i class="fas fa-share"></i>
                        <span class="action-text">分享</span>
                    </div>
                </div>
                
                <!-- 评论区域 -->
                <div class="comments-section">
                    <div class="comment-form">
                        <input type="text" class="comment-input" placeholder="写下你的回复...">
                        <button class="comment-btn">回复</button>
                    </div>
                    <div class="comments-list" data-post-id="${post.id}">
                        <!-- 评论将通过JS动态添加 -->
                    </div>
                </div>
            `;
            
            // 绑定事件
            bindPostEvents(postElement);
            
            return postElement;
        }
        
        function bindPostEvents(postElement) {
            const postId = postElement.dataset.postId;
            
            // 点赞功能
            const likeBtn = postElement.querySelector('.like-action');
            likeBtn.addEventListener('click', () => toggleLike(postId, likeBtn));
            
            // 评论功能
            const commentBtn = postElement.querySelector('.comment-action');
            const commentsSection = postElement.querySelector('.comments-section');
            
            commentBtn.addEventListener('click', () => {
                commentsSection.classList.toggle('expanded');
                
                if (commentsSection.classList.contains('expanded')) {
                    loadComments(postId, postElement.querySelector('.comments-list'));
                }
                
                // 更新图标
                const icon = commentBtn.querySelector('i');
                icon.className = commentsSection.classList.contains('expanded') ? 'fas fa-comment' : 'far fa-comment';
            });
            
            // 回复功能
            const replyBtn = postElement.querySelector('.comment-btn');
            const commentInput = postElement.querySelector('.comment-input');
            
            replyBtn.addEventListener('click', async () => {
                const commentText = commentInput.value.trim();
                if (!commentText) {
                    showToast('请输入评论内容', 'warning');
                    return;
                }
                
                await addComment(postId, commentText);
                commentInput.value = '';
                
                // 重新加载评论
                loadComments(postId, postElement.querySelector('.comments-list'));
                
                // 更新评论计数
                const commentCount = commentBtn.closest('.comment-action').querySelector('.action-count');
                commentCount.textContent = parseInt(commentCount.textContent) + 1;
                
                // 更新社区统计
                updateCommunityStats();
                updateMyStats();
            });
            
            // 分享功能
            const shareBtn = postElement.querySelector('.share-action');
            shareBtn.addEventListener('click', () => {
                copyToClipboard(window.location.href);
                shareBtn.classList.add('share-active');
                setTimeout(() => {
                    shareBtn.classList.remove('share-active');
                }, 1000);
            });
        }
        
        // ============================
        // 点赞功能
        // ============================
        async function toggleLike(postId, likeBtn) {
            if (!currentUserName) {
                showToast('请先设置用户名', 'warning');
                usernameInput.focus();
                return;
            }
            
            try {
                // 检查是否已经点赞
                const { data: existingLike } = await supabase
                    .from('likes')
                    .select('id')
                    .eq('post_id', postId)
                    .eq('user_id', currentUserName)
                    .maybeSingle();
                
                if (existingLike) {
                    // 取消点赞
                    await supabase
                        .from('likes')
                        .delete()
                        .eq('id', existingLike.id);
                    
                    likeBtn.classList.remove('liked');
                    const likeCount = likeBtn.querySelector('.action-count');
                    likeCount.textContent = parseInt(likeCount.textContent) - 1;
                    likeBtn.querySelector('i').className = 'far fa-thumbs-up';
                    
                    showToast('已取消点赞', 'info');
                } else {
                    // 点赞
                    await supabase
                        .from('likes')
                        .insert([{
                            post_id: postId,
                            user_id: currentUserName,
                            created_at: new Date().toISOString()
                        }]);
                    
                    likeBtn.classList.add('liked');
                    const likeCount = likeBtn.querySelector('.action-count');
                    likeCount.textContent = parseInt(likeCount.textContent) + 1;
                    likeBtn.querySelector('i').className = 'fas fa-thumbs-up';
                    
                    // 点赞动画
                    const likeAnimation = document.createElement('div');
                    likeAnimation.className = 'like-animation';
                    likeAnimation.innerHTML = '<i class="fas fa-heart"></i>';
                    likeBtn.appendChild(likeAnimation);
                    
                    setTimeout(() => {
                        likeAnimation.remove();
                    }, 1000);
                    
                    showToast('已点赞', 'success');
                }
                
                // 更新统计
                updateCommunityStats();
                updateMyStats();
            } catch (error) {
                console.error('点赞操作失败:', error);
                showToast('操作失败，请重试', 'warning');
            }
        }
        
        // ============================
        // 评论功能
        // ============================
        async function loadComments(postId, commentsList) {
            try {
                commentsList.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><p>加载评论中...</p></div>';
                
                const { data: comments, error } = await supabase
                    .from('comments')
                    .select('*')
                    .eq('post_id', postId)
                    .order('created_at', { ascending: true });
                
                if (error) throw error;
                
                commentsList.innerHTML = '';
                
                if (!comments || comments.length === 0) {
                    commentsList.innerHTML = '<div class="empty-state" style="padding: 20px;">暂无评论</div>';
                    return;
                }
                
                comments.forEach(comment => {
                    const commentTime = formatPostTime(comment.created_at);
                    const commentEl = document.createElement('div');
                    commentEl.className = 'comment';
                    commentEl.innerHTML = `
                        <div class="comment-header">
                            <div class="comment-author">${comment.user_id}</div>
                            <div class="comment-time">${commentTime}</div>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                    `;
                    commentsList.appendChild(commentEl);
                });
            } catch (error) {
                console.error('加载评论失败:', error);
                commentsList.innerHTML = '<div class="empty-state" style="padding: 20px;">加载失败</div>';
            }
        }
        
        async function addComment(postId, content) {
            try {
                const { error } = await supabase
                    .from('comments')
                    .insert([{
                        post_id: postId,
                        user_id: currentUserName,
                        content: content,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                showToast('评论发布成功', 'success');
                return true;
            } catch (error) {
                console.error('发布评论失败:', error);
                showToast('评论发布失败', 'warning');
                return false;
            }
        }
        
        // ============================
        // 发布帖子功能
        // ============================
        function initPostModal() {
            const postModal = document.getElementById('postModal');
            const newPostBtn = document.getElementById('newPostBtn');
            const closeModal = document.getElementById('closeModal');
            const cancelPost = document.getElementById('cancelPost');
            const submitPost = document.getElementById('submitPost');
            const postTitle = document.getElementById('postTitle');
            const postContent = document.getElementById('postContent');
            const tagOptions = document.querySelectorAll('.tag-option');
            const postTagsInput = document.getElementById('postTagsInput');
            const selectedTagsContainer = document.getElementById('selectedTags');
            const titleCount = document.getElementById('titleCount');
            const contentCount = document.getElementById('contentCount');
            
            // 打开模态框
            newPostBtn.addEventListener('click', () => {
                if (!currentUserName) {
                    showToast('请先设置用户名', 'warning');
                    usernameInput.focus();
                    return;
                }
                
                postModal.classList.add('active');
                postTitle.focus();
                selectedTags = [];
                updateSelectedTags();
            });
            
            // 关闭模态框
            [closeModal, cancelPost].forEach(btn => {
                btn.addEventListener('click', () => {
                    postModal.classList.remove('active');
                    resetPostForm();
                });
            });
            
            // 标题字符计数
            postTitle.addEventListener('input', () => {
                const length = postTitle.value.length;
                titleCount.textContent = `${length}/100`;
                titleCount.className = `char-count ${length > 90 ? 'warning' : ''}`;
            });
            
            // 内容字符计数
            postContent.addEventListener('input', () => {
                const length = postContent.value.length;
                contentCount.textContent = `${length}/2000`;
                contentCount.className = `char-count ${length > 1800 ? 'warning' : length > 1950 ? 'error' : ''}`;
            });
            
            // 标签选择
            tagOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const tag = option.dataset.tag;
                    
                    if (selectedTags.includes(tag)) {
                        selectedTags = selectedTags.filter(t => t !== tag);
                        option.classList.remove('selected');
                    } else {
                        selectedTags.push(tag);
                        option.classList.add('selected');
                    }
                    
                    updateSelectedTags();
                });
            });
            
            // 自定义标签输入
            postTagsInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const tag = postTagsInput.value.trim();
                    
                    if (tag && !selectedTags.includes(tag)) {
                        selectedTags.push(tag);
                        updateSelectedTags();
                    }
                    
                    postTagsInput.value = '';
                }
            });
            
            // 更新选中的标签显示
            function updateSelectedTags() {
                selectedTagsContainer.innerHTML = '';
                
                if (selectedTags.length === 0) {
                    selectedTagsContainer.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9rem;">暂无标签</p>';
                    return;
                }
                
                selectedTags.forEach(tag => {
                    const tagEl = document.createElement('span');
                    tagEl.className = 'tag';
                    tagEl.textContent = tag;
                    tagEl.style.marginRight = '8px';
                    tagEl.style.marginBottom = '8px';
                    tagEl.style.cursor = 'pointer';
                    
                    tagEl.addEventListener('click', () => {
                        selectedTags = selectedTags.filter(t => t !== tag);
                        tagOptions.forEach(option => {
                            if (option.dataset.tag === tag) {
                                option.classList.remove('selected');
                            }
                        });
                        updateSelectedTags();
                    });
                    
                    selectedTagsContainer.appendChild(tagEl);
                });
            }
            
            // 提交帖子
            submitPost.addEventListener('click', async () => {
                if (isSubmitting) return;
                
                const title = postTitle.value.trim();
                const content = postContent.value.trim();
                const category = document.getElementById('postCategory').value;
                
                // 验证
                if (!title) {
                    showToast('请填写帖子标题', 'warning');
                    postTitle.focus();
                    return;
                }
                
                if (!content) {
                    showToast('请填写帖子内容', 'warning');
                    postContent.focus();
                    return;
                }
                
                if (!category) {
                    showToast('请选择帖子分类', 'warning');
                    document.getElementById('postCategory').focus();
                    return;
                }
                
                if (selectedTags.length === 0) {
                    showToast('请至少添加一个标签', 'warning');
                    return;
                }
                
                isSubmitting = true;
                submitPost.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 发布中...';
                submitPost.disabled = true;
                
                try {
                    // 提交到Supabase
                    const { data, error } = await supabase
                        .from('posts')
                        .insert([{
                            title: title,
                            content: content,
                            author: currentUserName,
                            category: category,
                            tags: selectedTags.join(','),
                            created_at: new Date().toISOString()
                        }])
                        .select();
                    
                    if (error) throw error;
                    
                    // 显示成功消息
                    postModal.classList.remove('active');
                    document.getElementById('successModal').classList.add('active');
                    
                    // 重置表单
                    resetPostForm();
                    
                    // 重新加载帖子
                    loadPosts();
                    
                    // 更新统计
                    updateCommunityStats();
                    updateMyStats();
                    
                } catch (error) {
                    console.error('发布帖子失败:', error);
                    showToast(`发布失败: ${error.message}`, 'warning');
                } finally {
                    isSubmitting = false;
                    submitPost.innerHTML = '<i class="fas fa-paper-plane"></i> 发布帖子';
                    submitPost.disabled = false;
                }
            });
            
            // 重置表单
            function resetPostForm() {
                postTitle.value = '';
                postContent.value = '';
                document.getElementById('postCategory').selectedIndex = 0;
                postTagsInput.value = '';
                selectedTags = [];
                
                tagOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                updateSelectedTags();
                
                titleCount.textContent = '0/100';
                contentCount.textContent = '0/2000';
                titleCount.className = 'char-count';
                contentCount.className = 'char-count';
            }
        }
        
        // ============================
        // 统计功能
        // ============================
        async function updateCommunityStats() {
            try {
                // 总帖子数
                const { count: totalPosts } = await supabase
                    .from('posts')
                    .select('*', { count: 'exact', head: true });
                
                // 总点赞数
                const { count: totalLikes } = await supabase
                    .from('likes')
                    .select('*', { count: 'exact', head: true });
                
                // 总评论数
                const { count: totalComments } = await supabase
                    .from('comments')
                    .select('*', { count: 'exact', head: true });
                
                // 活跃用户数（发布过帖子或评论的用户）
                const { data: activeUsers } = await supabase
                    .from('posts')
                    .select('author')
                    .union(supabase.from('comments').select('user_id as author'));
                
                const uniqueUsers = [...new Set(activeUsers?.map(u => u.author) || [])];
                
                totalPostsCount.textContent = totalPosts || 0;
                totalLikesCount.textContent = totalLikes || 0;
                totalCommentsCount.textContent = totalComments || 0;
                activeUsersCount.textContent = uniqueUsers.length || 0;
            } catch (error) {
                console.error('更新社区统计失败:', error);
            }
        }
        
        async function updateMyStats() {
            if (!currentUserName) return;
            
            try {
                // 我的帖子数
                const { count: myPosts } = await supabase
                    .from('posts')
                    .select('*', { count: 'exact', head: true })
                    .eq('author', currentUserName);
                
                // 我的评论数
                const { count: myComments } = await supabase
                    .from('comments')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', currentUserName);
                
                myPostsCount.textContent = myPosts || 0;
                myCommentsCount.textContent = myComments || 0;
                
                // 更新我的头像和用户名
                profileAvatar.textContent = currentUserName.charAt(0).toUpperCase();
                profileUsername.textContent = currentUserName;
                
            } catch (error) {
                console.error('更新我的统计失败:', error);
            }
        }
        
        // ============================
        // 搜索功能
        // ============================
        async function searchPosts(searchTerm) {
            try {
                postsLoading.style.display = 'block';
                
                const { data: posts, error } = await supabase
                    .from('posts')
                    .select('*')
                    .or(`title.ilike.%${searchTerm}%,content.ilike.%${searchTerm}%,tags.ilike.%${searchTerm}%,author.ilike.%${searchTerm}%`)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                postsContainer.innerHTML = '';
                
                if (!posts || posts.length === 0) {
                    postsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>未找到相关帖子</h3>
                            <p>尝试使用其他关键词搜索</p>
                        </div>
                    `;
                    return;
                }
                
                for (const post of posts) {
                    const postElement = await createPostElement(post);
                    postsContainer.appendChild(postElement);
                }
            } catch (error) {
                console.error('搜索帖子失败:', error);
                showToast('搜索失败，请重试', 'warning');
            } finally {
                postsLoading.style.display = 'none';
            }
        }
        
        // ============================
        // 主题设置
        // ============================
        function initThemeSettings() {
            const themeModal = document.getElementById('themeModal');
            const closeThemeModal = document.getElementById('closeThemeModal');
            const cancelTheme = document.getElementById('cancelTheme');
            const saveTheme = document.getElementById('saveTheme');
            const themeOptions = document.querySelectorAll('.theme-option');
            
            // 打开主题设置
            document.querySelector('.my-card[data-action="theme"]').addEventListener('click', () => {
                themeModal.classList.add('active');
                
                const currentTheme = localStorage.getItem('theme') || 'light';
                themeOptions.forEach(option => {
                    const checkIcon = option.querySelector('.fa-check-circle');
                    if (option.dataset.theme === currentTheme) {
                        option.classList.add('active');
                        checkIcon.style.display = 'block';
                    } else {
                        option.classList.remove('active');
                        checkIcon.style.display = 'none';
                    }
                });
            });
            
            // 关闭主题设置
            [closeThemeModal, cancelTheme].forEach(btn => {
                btn.addEventListener('click', () => {
                    themeModal.classList.remove('active');
                });
            });
            
            // 选择主题
            themeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    themeOptions.forEach(opt => {
                        const checkIcon = opt.querySelector('.fa-check-circle');
                        opt.classList.remove('active');
                        checkIcon.style.display = 'none';
                    });
                    
                    this.classList.add('active');
                    const checkIcon = this.querySelector('.fa-check-circle');
                    checkIcon.style.display = 'block';
                });
            });
            
            // 保存主题
            saveTheme.addEventListener('click', () => {
                const selectedTheme = document.querySelector('.theme-option.active').dataset.theme;
                setTheme(selectedTheme);
                themeModal.classList.remove('active');
                showToast('主题设置已保存', 'success');
            });
            
            // 应用主题
            function setTheme(theme) {
                localStorage.setItem('theme', theme);
                
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark-theme');
                } else if (theme === 'light') {
                    document.documentElement.classList.remove('dark-theme');
                } else if (theme === 'auto') {
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.classList.add('dark-theme');
                    } else {
                        document.documentElement.classList.remove('dark-theme');
                    }
                }
            }
            
            // 加载保存的主题
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme);
            }
        }
        
        // ============================
        // 工具函数
        // ============================
        function formatPostTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '刚刚';
            if (diffMins < 60) return `${diffMins}分钟前`;
            if (diffHours < 24) return `${diffHours}小时前`;
            if (diffDays < 7) return `${diffDays}天前`;
            
            return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = toast.querySelector('.toast-message');
            const toastIcon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            
            if (type === 'success') {
                toastIcon.className = 'fas fa-check-circle';
            } else if (type === 'info') {
                toastIcon.className = 'fas fa-info-circle';
            } else if (type === 'warning') {
                toastIcon.className = 'fas fa-exclamation-triangle';
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showToast('链接已复制到剪贴板', 'success');
        }
        
        // ============================
        // 初始化事件监听器
        // ============================
        function initEventListeners() {
            // 页面切换
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const sectionId = this.getAttribute('data-section');
                    
                    document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(sectionId).classList.add('active');
                    
                    if (window.innerWidth <= 992) {
                        window.scrollTo(0, 0);
                    }
                    
                    // 如果切换到社区页面，更新统计
                    if (sectionId === 'community') {
                        updateCommunityStats();
                    }
                    
                    // 如果切换到我的页面，更新我的统计
                    if (sectionId === 'profile') {
                        updateMyStats();
                    }
                });
            });
            
            // 搜索功能
            let searchTimer;
            [postSearch, globalSearch].forEach(input => {
                input.addEventListener('input', (e) => {
                    clearTimeout(searchTimer);
                    const query = e.target.value.trim();
                    
                    if (query) {
                        searchTimer = setTimeout(() => {
                            searchPosts(query);
                        }, 500);
                    } else {
                        loadPosts();
                    }
                });
            });
            
            // 关于我们
            document.querySelector('.my-card[data-action="about"]').addEventListener('click', () => {
                showToast('TechHub社区 v1.0 - 基于Supabase的科技分享平台', 'info');
            });
            
            // 成功模态框按钮
            document.getElementById('closeSuccessModal').addEventListener('click', () => {
                document.getElementById('successModal').classList.remove('active');
            });
            
            document.getElementById('newPostBtn2').addEventListener('click', () => {
                document.getElementById('successModal').classList.remove('active');
                document.getElementById('newPostBtn').click();
            });
            
            // 初始化发帖模态框
            initPostModal();
            
            // 响应式调整
            window.addEventListener('resize', () => {
                if (window.innerWidth > 992) {
                    const activeSection = document.querySelector('.content-section.active').id;
                    document.querySelectorAll('.nav-item').forEach(item => {
                        if (item.getAttribute('data-section') === activeSection) {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                }
            });
        }
    </script>
</body>
</html>